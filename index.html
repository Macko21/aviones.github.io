<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Space War: Advanced Warfare</title>
    <style>
        :root { --neon: #00f2ff; --gold: #ffcc00; --ammo: #ff00ff; }
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        #game-container { position: relative; border: 2px solid #333; box-shadow: 0 0 50px rgba(0, 242, 255, 0.15); background: #02020a; width: 800px; height: 600px; }
        canvas { display: block; }
        .ui-panel { position: absolute; top: 15px; left: 20px; right: 20px; display: flex; justify-content: space-between; pointer-events: none; z-index: 10; text-shadow: 0 0 10px #000; }
        #menu-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20; }
        .shop-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
        .upgrade-card { background: #111; padding: 15px; border: 1px solid #444; border-radius: 8px; width: 160px; text-align: center; }
        button { padding: 10px; background: var(--neon); border: none; font-weight: bold; cursor: pointer; border-radius: 4px; width: 100%; margin-top: 10px; }
        button:disabled { background: #333; color: #777; }
        .timer-bar { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 200px; height: 5px; background: rgba(255,255,255,0.1); display: none; }
        #double-fill { height: 100%; background: var(--neon); width: 100%; }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="ui-panel">
            <div>CR√âDITOS: <span id="coins-ui" style="color:var(--gold)">0</span> | HP: <span id="lives-ui" style="color:#ff4d4d"></span></div>
            <div style="text-align:right">
                <div id="score-ui" style="font-size: 20px;">0000</div>
                <div id="weapon-ui" style="font-size: 10px; color:var(--ammo)">MISIL EST√ÅNDAR</div>
            </div>
        </div>

        <div class="timer-bar" id="double-timer"><div id="double-fill"></div><div style="font-size:9px; text-align:center">DISPARO DOBLE</div></div>
        
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <div id="menu-overlay">
            <h1 id="menu-title" style="letter-spacing:5px; color:var(--neon)">SPACE WAR</h1>
            
            <div id="shop-content" style="display:none">
                <div class="shop-grid">
                    <div class="upgrade-card"><div>MOTOR</div><div id="lvl-speed" style="color:var(--neon)">Lvl 0</div><button id="btn-speed" onclick="buyUpgrade('speed')">-</button></div>
                    <div class="upgrade-card"><div>CADENCIA</div><div id="lvl-fire" style="color:var(--neon)">Lvl 0</div><button id="btn-fire" onclick="buyUpgrade('fire')">-</button></div>
                    <div class="upgrade-card"><div>ESCUDO</div><div id="lvl-life" style="color:var(--neon)">Lvl 0</div><button id="btn-life" onclick="buyUpgrade('life')">-</button></div>
                    <div class="upgrade-card"><div>ARMAS</div><div id="lvl-ammo" style="color:var(--ammo)">Lvl 0</div><button id="btn-ammo" onclick="buyUpgrade('ammo')">-</button></div>
                </div>
            </div>

            <button onclick="initGame()" style="width:250px; font-size:18px" id="main-btn">INICIAR MISI√ìN</button>
            <p style="font-size:11px; color:#555; margin-top:20px;">P: TIENDA | X: NUKE | ESPACIO: DISPARAR</p>
        </div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let gameActive = false, isPaused = false, score = 0, coins = 0;
    let player, bullets = [], enemies = [], stars = [], particles = [], bonuses = [], boss = null;
    let keys = {}, doubleShotTimer = 0;
    
    let shopLevels = { fire: 0, speed: 0, life: 0, ammo: 0 };
    let shopPrices = { fire: 200, speed: 150, life: 250, ammo: 400 };
    const WEAPONS = ["EST√ÅNDAR", "PLASMA", "FOT√ìN", "DESTRUCTOR", "ANIKILADOR"];

    function createStars() {
        stars = Array.from({length: 100}, () => ({ x: Math.random()*800, y: Math.random()*600, v: Math.random()*3 + 1 }));
    }

    // --- DIBUJO DE SPRITES ---
    function drawShip(x, y, isPlayer, color) {
        ctx.save();
        ctx.translate(x, y);
        if(!isPlayer) ctx.rotate(Math.PI);

        // Sombras y brillo
        ctx.shadowBlur = 10;
        ctx.shadowColor = color;

        // Alas traseras
        ctx.fillStyle = "#333";
        ctx.fillRect(-22, 5, 44, 5);
        
        // Cuerpo Principal
        let grad = ctx.createLinearGradient(-15, 0, 15, 0);
        grad.addColorStop(0, "#555");
        grad.addColorStop(0.5, color);
        grad.addColorStop(1, "#555");
        ctx.fillStyle = grad;
        
        ctx.beginPath();
        ctx.moveTo(0, -28); 
        ctx.lineTo(-18, 12); ctx.lineTo(-8, 8); 
        ctx.lineTo(8, 8); ctx.lineTo(18, 12);
        ctx.closePath(); ctx.fill();

        // Cabina
        ctx.fillStyle = "rgba(0, 242, 255, 0.7)";
        ctx.beginPath();
        ctx.ellipse(0, -5, 5, 10, 0, 0, Math.PI*2);
        ctx.fill();

        // Motores
        if(isPlayer && Math.random() > 0.2) {
            ctx.fillStyle = "#ffaa00";
            ctx.fillRect(-12, 12, 6, 10 * Math.random() + 5);
            ctx.fillRect(6, 12, 6, 10 * Math.random() + 5);
        }
        ctx.restore();
    }

    window.onkeydown = e => { keys[e.code] = true; if(e.code === "KeyP" && gameActive) toggleShop(); };
    window.onkeyup = e => keys[e.code] = false;

    function initGame() {
        score = 0; coins = 0; shopLevels = { fire: 0, speed: 0, life: 0, ammo: 0 };
        player = { x: 400, y: 500, lives: 3, lastShot: 0, invincible: 0, fireRate: 450, speed: 6 };
        bullets = []; enemies = []; bonuses = []; particles = []; boss = null;
        createStars();
        gameActive = true; isPaused = false;
        document.getElementById("menu-overlay").style.display = "none";
        document.getElementById("shop-content").style.display = "block";
        updateUI();
        requestAnimationFrame(loop);
    }

    function toggleShop() {
        isPaused = !isPaused;
        document.getElementById("menu-overlay").style.display = isPaused ? "flex" : "none";
        updateUI();
        if(!isPaused) requestAnimationFrame(loop);
    }

    function buyUpgrade(t) {
        if(coins >= shopPrices[t] && shopLevels[t] < 5) {
            coins -= shopPrices[t]; shopLevels[t]++;
            shopPrices[t] = Math.floor(shopPrices[t] * 2.2);
            if(t === 'fire') player.fireRate -= 70;
            if(t === 'speed') player.speed += 1.5;
            if(t === 'life') player.lives++;
            if(t === 'ammo') score += 50; // Peque√±o bono al comprar munici√≥n
            updateUI();
        }
    }

    function loop() {
        if(!gameActive || isPaused) return;
        ctx.clearRect(0,0,800,600);
        updateLogic();
        draw();
        requestAnimationFrame(loop);
    }

    function updateLogic() {
        const now = Date.now();
        if(keys["ArrowLeft"] && player.x > 30) player.x -= player.speed;
        if(keys["ArrowRight"] && player.x < 770) player.x += player.speed;
        if(keys["ArrowUp"] && player.y > 30) player.y -= player.speed;
        if(keys["ArrowDown"] && player.y < 570) player.y += player.speed;

        // Disparo
        if(keys["Space"] && now - player.lastShot > player.fireRate) {
            let ammoSize = 5 + (shopLevels.ammo * 2);
            if(doubleShotTimer > now) {
                bullets.push({x: player.x - 15, y: player.y, s: ammoSize});
                bullets.push({x: player.x + 15, y: player.y, s: ammoSize});
            } else {
                bullets.push({x: player.x, y: player.y, s: ammoSize});
            }
            player.lastShot = now;
        }

        // Timer de Doble Disparo
        if(doubleShotTimer > now) {
            document.getElementById("double-timer").style.display = "block";
            let pct = (doubleShotTimer - now) / 8000;
            document.getElementById("double-fill").style.width = (pct * 100) + "%";
        } else {
            document.getElementById("double-timer").style.display = "none";
        }

        bullets.forEach((b, i) => { 
            b.y -= 14; 
            if(b.y < -20) bullets.splice(i, 1); 
        });

        // Spawn de Enemigos (Naves)
        if(Math.random() < 0.03 + (score/15000)) {
            enemies.push({x: Math.random()*800, y: -50, v: 4 + Math.random()*2, hp: 1 + Math.floor(score/1000)});
        }

        enemies.forEach((en, i) => {
            en.y += en.v;
            if(Math.hypot(en.x - player.x, en.y - player.y) < 35 && now > player.invincible) onHit();
            bullets.forEach((b, bi) => {
                if(Math.hypot(en.x - b.x, en.y - b.y) < 30) {
                    createExplosion(en.x, en.y, "#f55", 10);
                    enemies.splice(i, 1); bullets.splice(bi, 1);
                    score += 10; coins += 15;
                    if(Math.random() < 0.08) bonuses.push({x: en.x, y: en.y, type: 'double'});
                    updateUI();
                }
            });
            if(en.y > 650) enemies.splice(i,1);
        });

        // Bonos
        bonuses.forEach((b, i) => {
            b.y += 3;
            if(Math.hypot(b.x - player.x, b.y - player.y) < 30) {
                doubleShotTimer = Date.now() + 8000;
                bonuses.splice(i, 1);
            }
        });

        stars.forEach(s => { s.y += s.v; if(s.y > 600) s.y = 0; });
        particles.forEach((p, i) => { p.y += 2; p.life--; if(p.life <= 0) particles.splice(i,1); });
    }

    function onHit() {
        player.lives--; player.invincible = Date.now() + 2000; updateUI();
        if(player.lives <= 0) gameOver();
    }

    function createExplosion(x, y, color, n) {
        for(let i=0; i<n; i++) particles.push({x, y: y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, life: 30, color});
    }

    function draw() {
        // Estrellas
        ctx.fillStyle = "#fff"; stars.forEach(s => ctx.fillRect(s.x, s.y, 1.5, 1.5));
        
        // Enemigos
        enemies.forEach(en => drawShip(en.x, en.y, false, "#ff4d4d"));

        // Balas
        bullets.forEach(b => {
            ctx.shadowBlur = 10; ctx.shadowColor = "#ff00ff";
            ctx.fillStyle = "#ff00ff";
            ctx.beginPath();
            ctx.ellipse(b.x, b.y, b.s/2.5, b.s*2, 0, 0, Math.PI*2);
            ctx.fill();
            ctx.shadowBlur = 0;
        });

        // Bonos
        bonuses.forEach(b => {
            ctx.fillStyle = "#00f2ff"; ctx.beginPath(); ctx.arc(b.x, b.y, 15, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "#000"; ctx.fillText("D", b.x-4, b.y+5);
        });

        // Jugador
        if(Date.now() > player.invincible || Math.floor(Date.now()/100)%2==0) {
            drawShip(player.x, player.y, true, "#00f2ff");
        }
    }

    function updateUI() {
        document.getElementById("coins-ui").innerText = coins;
        document.getElementById("score-ui").innerText = score.toString().padStart(4, '0');
        document.getElementById("lives-ui").innerText = "‚ù§".repeat(Math.max(0, player.lives));
        document.getElementById("weapon-ui").innerText = "ARCO TIPO: " + WEAPONS[shopLevels.ammo];
        ['fire', 'speed', 'life', 'ammo'].forEach(t => {
            document.getElementById("lvl-"+t).innerText = "Lvl " + shopLevels[t];
            let btn = document.getElementById("btn-"+t);
            btn.innerText = shopLevels[t] >= 5 ? "MAX" : shopPrices[t] + " ü™ô";
            btn.disabled = coins < shopPrices[t] || shopLevels[t] >= 5;
        });
    }

    function gameOver() {
        gameActive = false;
        document.getElementById("menu-overlay").style.display = "flex";
        document.getElementById("menu-title").innerText = "NAVE DESTRUIDA";
        document.getElementById("main-btn").innerText = "REINTENTAR";
    }
</script>
</body>
</html>
